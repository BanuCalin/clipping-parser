language: rust
cache: cargo

os:
  - linux

rust:
  - stable
  - nightly

jobs:
  include:
    - rust: nightly
      before_install:
        - cargo install grcov
      script:
        - rustup component add llvm-tools-preview
        - ./profile.sh -t cov -- -f test_clippings.txt
      after_success:
        - bash <(curl -s https://codecov.io/bash) -s ./profile
  allow_failures:
    - rust: nightly
  fast_finish: true

script:
  - cargo build
  - cargo run -- -h